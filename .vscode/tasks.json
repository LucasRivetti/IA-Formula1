{
  "version": "2.0.0",
  "options": {
    "cwd": "${workspaceFolder}",
    "env": {
      "PYTHONUNBUFFERED": "1",
      "MKL_NUM_THREADS": "1",
      "OPENBLAS_NUM_THREADS": "1"
    }
  },
  "tasks": [
    {
      "label": "1) Features",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.features",
        "--input", "data/f1_dados_filtrados.csv",
        "--output", "data/processed.parquet",
        "--meta", "data/meta.json"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "2) Train – RF (FULL POWER, progresso)",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.train",
        "--data", "data/processed.parquet",
        "--meta", "data/meta.json",
        "--save", "models/best_model.joblib",
        "--model", "rf",
        "--rf_verbose", "1",
        "--n_estimators", "1200",
        "--min_samples_leaf", "1",
        "--max_depth", "None",
        "--max_features", "sqrt",
        "--n_jobs", "-1"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "2a) Train – RF (FAST, ${input:limitFolds} folds)",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.train",
        "--data", "data/processed.parquet",
        "--meta", "data/meta.json",
        "--save", "models/best_model.joblib",
        "--model", "rf",
        "--rf_verbose", "0",
        "--n_estimators", "400",
        "--min_samples_leaf", "1",
        "--max_depth", "None",
        "--max_features", "sqrt",
        "--n_jobs", "-1",
        "--limit_folds", "${input:limitFolds}"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "2b) Train – HGB (rápido, progresso)",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.train",
        "--data", "data/processed.parquet",
        "--meta", "data/meta.json",
        "--save", "models/best_model.joblib",
        "--model", "hgb",
        "--hgb_iter", "800",
        "--hgb_lr", "0.06",
        "--hgb_max_depth", "None"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "3) Evaluate por GP",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.evaluate",
        "--model", "models/best_model.joblib",
        "--data", "data/processed.parquet",
        "--groupby", "gp_key"
      ],
      "group": "build",
      "problemMatcher": []
    },

    {
      "label": "4a) Scenario – Stint Fixo",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.scenario_track",
        "--gp", "${input:gp}",
        "--stintage", "${input:stintage}",
        "--compounds", "${input:compounds}",
        "--top", "${input:topN}"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "4b) Scenario – Grid de stintage (busca)",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.scenario_track",
        "--gp", "${input:gp}",
        "--stintage_grid",
        "${input:stinIni}", "${input:stinFim}", "${input:stinPasso}",
        "--compounds", "${input:compounds}",
        "--top", "${input:topN}"
      ],
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "4c) Scenario – Listar GPs",
      "type": "shell",
      "command": "${command:python.interpreterPath}",
      "args": [
        "-u", "-m", "src.scenario_track",
        "--list_gps"
      ],
      "group": "build",
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "limitFolds",
      "type": "promptString",
      "description": "Quantos folds LOGPO deseja (para treino FAST)?",
      "default": "6"
    },
    {
      "id": "gp",
      "type": "promptString",
      "description": "Pista (substring do gp_key; ex.: Monza, Interlagos, Spa)",
      "default": "Monza"
    },
    {
      "id": "stintage",
      "type": "promptString",
      "description": "Idade do pneu (stint fixo)",
      "default": "7"
    },
    {
      "id": "stinIni",
      "type": "promptString",
      "description": "Stint inicial (grid)",
      "default": "4"
    },
    {
      "id": "stinFim",
      "type": "promptString",
      "description": "Stint final (grid)",
      "default": "18"
    },
    {
      "id": "stinPasso",
      "type": "promptString",
      "description": "Passo do stint (grid)",
      "default": "1"
    },
    {
      "id": "compounds",
      "type": "promptString",
      "description": "Compounds (use rótulos do dataset, ex.: SOFT,MEDIUM,HARD)",
      "default": "SOFT,MEDIUM,HARD"
    },
    {
      "id": "topN",
      "type": "promptString",
      "description": "Quantas combinações mostrar (Top-N)?",
      "default": "10"
    }
  ]
}
